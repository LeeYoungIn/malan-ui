import { NextIntlClientProvider } from 'next-intl'
import { getTranslations, setRequestLocale } from 'next-intl/server'
import { PropsWithChildren } from 'react'

import { GeistSans } from 'geist/font/sans'
import { GeistMono } from 'geist/font/mono'

import { getMessages } from '@/i18n'
import { locales } from '@/navigation'
import { getMetadata } from '@lib/metadata'

import Footer from '@ui/organisms/footer'
import Header from '@ui/organisms/header'
import Navbar, { NavProvider } from '@ui/organisms/navbar'
import { ThemeContextProvider } from '@ui/organisms/themeLayout'

export function generateStaticParams() {
  return locales.map(locale => ({ locale }))
}

export async function generateMetadata(props: LocaleParams) {
  const params = await props.params
  const t = await getTranslations({ locale: params.locale })
  return getMetadata({
    title: t('title'),
    description: 'Generated by create next app'
  })
}

export default async function RootLayout(props: LocaleParams & PropsWithChildren) {
  const params = await props.params
  const { locale } = params
  setRequestLocale(locale)

  let messages
  try {
    messages = await getMessages(locale)
  } catch (e) { }

  return <NextIntlClientProvider locale={locale} messages={messages}>
    <ThemeContextProvider>
      <NavProvider>
        <html lang={locale} className={`${GeistSans.variable} ${GeistMono.variable}`}>
        <body className="w-full h-full bg-stone-50 dark:bg-stone-950 text-black dark:text-white">
        <Header/>
        <main className="container grid grid-cols-[max-content_1fr]">
          <Navbar/>
          <div className="px-4 py-2.5">
            {props.children}
          </div>
        </main>
        <Footer/>
        </body>
        </html>
      </NavProvider>
    </ThemeContextProvider>
  </NextIntlClientProvider>
}